<!DOCTYPE html>
<html>    
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Installing LLVM from Source on Ubuntu 16.04 -- Arpith K </title>
  <meta name="description" content="A quick guide on installing LLVM and Clang on Ubuntu 16.04 with Ninja build system">
  <meta name="author" content="Arpith K">

  

  <meta property="og:title" content="Installing LLVM from Source on Ubuntu 16.04">
  
  <meta property="og:description" content="A quick guide on installing LLVM and Clang on Ubuntu 16.04 with Ninja build system">
  <meta property="og:url" content="http://arpith.xyz/2016/06/installing-llvm-from-source-ubuntu-16-04/">

  <link rel="stylesheet" href="http://arpith.xyz/css/main.css" | prepend: site.baseurl }}">
  <link rel="canonical" href="http://arpith.xyz/2016/06/installing-llvm-from-source-ubuntu-16-04/">
  <link rel="alternate" type="application/atom+xml" title="Arpith K" href="http://arpith.xyz/feed.xml" | prepend: site.baseurl | prepend: site.url }}" />
  <script src="http://arpith.xyz/scripts/jquery-1.11.2.min.js"></script>
  <script src="http://arpith.xyz/scripts/pithy.js"></script>

  <script src="http://arpith.xyz/scripts/konami.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77896043-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

  var easter_egg = new Konami('/NyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyanNyan/');

  </script>
  	
</head>


  <body>
    <header class="header">
	<div class="header-container">
		<div class="nav">
			
				<li>
					<a href="http://arpith.xyz">home</a>
				</li>			
			
			
				<li>
					<a href="http://arpith.xyz/blog/">blog</a>
				</li>			
			
			
				<li>
					<a href="http://arpith.xyz/archive/">archive</a>
				</li>			
			
			
				<li>
					<a href="http://arpith.xyz/tag/">tags</a>
				</li>			
			
			
				<li>
					<a href="http://arpith.xyz/misc/">misc</a>
				</li>			
			
			
				<li>
					<a href="http://arpith.xyz/books/">books</a>
				</li>			
			
		</div>
		<div class="description"> A scrapbook full of random scripts </div>		
		<ul class="social-links">

			
			<li>
				<a href="https://github.com/arpith20" title="Github" target="_blank">
					<i class="fa fa fa-github fa-2x"></i>
				</a>
			</li>
			<li>
				<a href="https://twitter.com/_arpith" title="Twitter" target="_blank">
					<i class="fa fa-twitter fa-2x"></i>
				</a>
			</li>
			<li>
				<a href="/books/" title="Goodreads">
					<i class="fa fa-book fa-2x"></i>
				</a>
			</li>
			<li>
				<a href="/feed.xml" title="RSS">
					<i class="fa fa-rss fa-2x"></i>
				</a>
			</li>
			

			

			

			
		</ul>		
	</div>
</header>

    <br>
    <div class="page-content">
      <div class="wrapper">
        <div class="post">
  <br>
  <header class="post-header">
    <h1 class="post-title">Installing LLVM from Source on Ubuntu 16.04</h1>
    <p class="post-meta">Jun 14, 2016 • Arpith K</p>
  </header>

  <article class="post-content">
    <center>
<img src="/assets/llvm/LLVM-Logo-Derivative-4.png" />
</center>

<p><br /></p>
<h2>Table Of Contents</h2>

<ul id="markdown-toc">
  <li><a href="#download-source-code" id="markdown-toc-download-source-code">Download Source Code</a></li>
  <li><a href="#configure-llvm-and-clang" id="markdown-toc-configure-llvm-and-clang">Configure LLVM and Clang</a></li>
  <li><a href="#using-ninja-to-build-llvm-and-clang" id="markdown-toc-using-ninja-to-build-llvm-and-clang">Using Ninja to build LLVM and Clang</a></li>
  <li><a href="#install-llvm" id="markdown-toc-install-llvm">Install LLVM</a></li>
  <li><a href="#updating-source" id="markdown-toc-updating-source">Updating Source</a></li>
</ul>

<p>This is a quick guide on building LLVM and Clang from source and installing them on a machine running Ubuntu 16.04 using Ninja build system.</p>

<h2 id="download-source-code">Download Source Code</h2>

<p>The first step is to download the source from llvm’s repository. To do so,</p>

<ul>
  <li>Checkout LLVM:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$cd</span> where-you-want-llvm-to-live
<span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/llvm/trunk llvm
</code></pre>
</div>

<ul>
  <li>Checkout Clang:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$cd</span> llvm/tools
<span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/cfe/trunk clang
</code></pre>
</div>

<ul>
  <li>Checkout Compiler-RT (required to build the sanitizers) [Optional]:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$cd</span> ../projects
<span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/compiler-rt/trunk compiler-rt
</code></pre>
</div>

<ul>
  <li>Checkout Libomp (required for OpenMP support) [Optional]:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/openmp/trunk openmp
</code></pre>
</div>

<ul>
  <li>Checkout libcxx and libcxxabi [Optional]:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/libcxx/trunk libcxx
<span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/libcxxabi/trunk libcxxabi
</code></pre>
</div>

<ul>
  <li>Get the Test Suite Source Code [Optional]</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$svn</span> co http://llvm.org/svn/llvm-project/test-suite/trunk <span class="nb">test</span>-suite
</code></pre>
</div>

<h2 id="configure-llvm-and-clang">Configure LLVM and Clang</h2>

<p>It must be noted that the LLVM project no longer supports building with configure &amp; make. 
We have to use CMake-based build system.</p>

<p>It is recommended to create a new build directory somewhere outside the source directory. To do this,</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$cd</span> ../..
<span class="nv">$mkdir</span> build
<span class="nv">$cd</span> build
</code></pre>
</div>

<p>In the build directory, run the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$cmake</span> -G <span class="s2">"Ninja"</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/install/path -DLLVM_TARGETS_TO_BUILD<span class="o">=</span>AArch64 /pathto/llvm/
</code></pre>
</div>
<p>The general syntax of cmake is <code class="highlighter-rouge">cmake -G &lt;generator&gt; [options] &lt;path to llvm sources&gt;</code>.</p>

<p>I prefer to use Ninja build system. Some common generators are:</p>

<ul>
  <li><code class="highlighter-rouge">Unix Makefiles</code> — for generating make-compatible parallel makefiles.</li>
  <li><code class="highlighter-rouge">Ninja</code> — for generating Ninja build files. Most llvm developers use Ninja.</li>
  <li><code class="highlighter-rouge">Visual Studio</code> — for generating Visual Studio projects and solutions.</li>
  <li><code class="highlighter-rouge">Xcode</code> — for generating Xcode projects.</li>
</ul>

<p>Variables are passed to cmake on the command line using the format <code class="highlighter-rouge">-D&lt;variable name&gt;=&lt;value&gt;</code>. 
The following are the variables that I pass:</p>

<ul>
  <li>
    <p>LLVM_TARGETS_TO_BUILD <br />
This controls which targets is built and linked into llc.</p>

    <p>The various values that this semicolon delimited list can include  are <code class="highlighter-rouge">AArch64, AMDGPU, ARM, BPF, Hexagon, Mips, MSP430, NVPTX, PowerPC, Sparc, SystemZ, X86, XCore</code>.</p>

    <p>Here, in the example, I choose to use <code class="highlighter-rouge">AArch64</code> as my target. You can set <code class="highlighter-rouge">LLVM_TARGETS_TO_BUILD=host</code> instead. The list is set to LLVM_ALL_TARGETS as default. Doing this however, increases the build time considerably.</p>
  </li>
  <li>
    <p>CMAKE_INSTALL_PREFIX <br />
This specifies the directory where you want the LLVM tools and libraries to be installed (default /usr/local). DO NOT use relative paths for this.</p>
  </li>
</ul>

<h2 id="using-ninja-to-build-llvm-and-clang">Using Ninja to build LLVM and Clang</h2>
<p>Running <code class="highlighter-rouge">cmake</code> would have generated a file called <code class="highlighter-rouge">build.ninja</code>. At this stage, to build LLVM, just invoke <code class="highlighter-rouge">ninja</code>. You might want to download Ninja binaries for your system from <a href="https://github.com/ninja-build/ninja/releases" target="_blank">here</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$ninja</span>
</code></pre>
</div>
<p>Depending upon the configuration, this step might take considerable amount of time and system resource.</p>
<center>
<a href="/assets/llvm/sysres.png"><img src="/assets/llvm/sysres.png" width="100%" title="The build process is very CPU intensive!" /></a>
</center>
<p><br /></p>

<h2 id="install-llvm">Install LLVM</h2>
<p>To install LLVM,</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$ninja</span> install
</code></pre>
</div>

<p>This installs LLVM binaries and libraries in the directory specified by the <code class="highlighter-rouge">CMAKE_INSTALL_PREFIX</code> variable.</p>

<p>If you choose to do so, the final step would be to include the path to llvm binary files in <code class="highlighter-rouge">$PATH</code> environment variable.</p>

<center>
<a href="/assets/llvm/finalres.png"><img src="/assets/llvm/finalres.png" /></a>
</center>

<p><br /></p>

<h2 id="updating-source">Updating Source</h2>

<p>To update all components of LLVM infrastructure,</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">$cd</span>  where-llvm-lives
<span class="nv">$svn</span> update . ./tools/clang/ ./projects/compiler-rt/ ./projects/openmp/ ./projects/libcxx ./projects/libcxxabi/ ./projects/test-suite/
</code></pre>
</div>
<p>After this, build the project again using the aforementioned procedure.</p>

<center>
<a href="https://ninja-build.org/" target="blank"><img src="/assets/llvm/ninja.png" width="50px" /></a>
</center>
<p><br /></p>

  </article>


	<hr/>
	<br/>
	<h2> Comments </h2>
	<div id="disqus_thread"></div>
	<script>
	/**
	* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
	*/
	/*
	var disqus_config = function () {
	this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
	this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	*/
	(function() { // DON'T EDIT BELOW THIS LINE
	var d = document, s = d.createElement('script');

	s.src = '//arpith.disqus.com/embed.js';

	s.setAttribute('data-timestamp', +new Date());
	(d.head || d.body).appendChild(s);
	})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

      </div>
    </div>
    
    <style>

	.thumbnail img{
		display:none;
	}    

	.thumbnail:hover img {

		display:block;
		position: absolute;
		right: 0px;
		bottom: 0px;
	}
</style>
<footer class="footer">
	<div id="gotop">^</div>
	<br>
	<div class="thumbnail">
		<a href="/license/">CC</a> 2016 Arpith K<br/>
		Hosted on GitHub<br/>
		&nbsp;
		<img src="/images/CC-BY-SA_icon.svg" />
	</div>
</footer>

    
  </body>

</html>
